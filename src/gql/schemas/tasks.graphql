fragment TaskStatus on TaskStatusDto {
  id
  nameTh
  nameEn
  color
}

fragment TaskSource on TaskSourceDto {
  id
  nameTh
  nameEn
  color
}

fragment TaskRangeTime on TaskRangeTimeDto {
  id
  nameTh
  nameEn
}

fragment Task on Task {
  id
  code
  projectId
  unitId
  unitNumber
  status {
    ...TaskStatus
  }
  source {
    ...TaskSource
  }
  customerName
  customerPhone
  checkInDate
  checkInRangeTime {
    ...TaskRangeTime
  }
  insuranceDateDefault
  insuranceDate
  transferDate
  customerRequestedRepairDate
  createdAt
  updatedAt
  deletedAt
  project {
    id
    nameTh
    nameEn
  }
  unit {
    id
    projectId
    unitNumber
    houseNumber
  }
  area {
    id
    nameEn
    nameEn
  }
  building {
    id
    nameEn
    nameEn
  }
  floor {
    id
    nameEn
    nameEn
  }
  details {
    id
    code
  }
}

fragment TaskStatusDto on TaskStatusDto {
  id
  nameEn
  nameTh
  color
}

query Tasks(
  $type: TaskType!
  $page: Int!
  $limit: Int!
  $searchText: String
  $statuses: [TaskStatus!]
  $projectId: String
  $unitIds: [String!]
  $sources: [String!]
  $checkInDate: [String!]
  $createdAt: [String!]
) {
  tasks(
    type: $type
    page: $page
    limit: $limit
    searchText: $searchText
    statuses: $statuses
    projectId: $projectId
    unitIds: $unitIds
    sources: $sources
    checkInDate: $checkInDate
    createdAt: $createdAt
  ) {
    meta {
      ...IPaginateMeta
    }
    links {
      ...IPaginateLinks
    }
    items {
      ...Task
    }
  }
}

fragment TaskDetail on TaskDetail {
  id
  taskId
  code
  status {
    ...TaskStatus
  }
  homecareStatus {
    ...TaskStatus
  }
  priority
  description
  categoryId
  subCategoryId
  slaId
  causeId
  contractorId
  homecareId
  homecareInDate
  homecareComment
  assignInDate
  appointmentDate
  appointmentTime
  appointmentRepairDate
  appointmentRepairTime
  appointmentRepairComment
  callingDate
  assignDate
  inProgressDate
  reProcessDate
  finishDate
  closeDate
  isCSAT
  CSATComment
  createdAt
  updatedAt
  deletedAt
  homecareInRangeTime {
    ...TaskRangeTime
  }
  assignRangeTime {
    ...TaskRangeTime
  }
}

fragment UploadFile on UploadFile {
  id
  refId
  fileId
  fileType
  fileName
  fileFolder
  filePath
  fileBucket
  fileExtension
  fileUrl
  isPublic
  createdAt
  updatedAt
  deletedAt
}

query Task($id: ID!) {
  task(id: $id) {
    ...Task
    details {
      ...TaskDetail
      images {
        ...UploadFile
      }
      category {
        ...Master
      }
      subCategory {
        ...Master
      }
      homecare {
        ...User
      }
      cause {
        ...Master
      }
      contractor {
        ...Master
      }
      sla {
        ...Master
        parent {
          ...Master
        }
      }
      assigns {
        id
        code
        images {
          ...UploadFile
        }
      }
    }
  }
}

query TaskStatuses {
  taskStatuses {
    ...TaskStatusDto
  }
}

mutation CreateTask(
  $createTaskInput: CreateTaskInput!
  $createTaskDetailInput: [CreateTaskDetailInput!]!
) {
  createTask(
    createTaskInput: $createTaskInput
    createTaskDetailInput: $createTaskDetailInput
  ) {
    ...Task
  }
}
